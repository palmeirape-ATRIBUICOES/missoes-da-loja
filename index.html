<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Missões</title>

<meta name="theme-color" content="#2563eb"/>

<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-4">

<!-- ================= HEADER ================= -->
<header class="max-w-5xl mx-auto mb-4">
<div class="bg-white rounded-xl shadow p-4 flex justify-between items-center">
<div>
<h1 class="text-xl font-bold">Missões</h1>
<p id="headerSubtitle" class="text-sm text-gray-500">Login</p>
</div>
<div id="headerPoints" class="hidden text-right">
<div class="text-xs text-gray-500">Pontos do mês</div>
<div id="headerPointsValue" class="text-lg font-bold">0</div>
</div>
</div>
</header>

<!-- ================= LOGIN ================= -->
<section id="loginSection" class="max-w-4xl mx-auto bg-white p-4 rounded-xl shadow">
<h2 class="font-semibold mb-3">Entrar</h2>

<div class="grid md:grid-cols-4 gap-3">
<div>
<label class="text-sm">Loja</label>
<select id="storeSelect" class="w-full border p-2 rounded">
<option value="principal">Loja Principal</option>
<option value="bogados">Bogados</option>
</select>
</div>

<div>
<label class="text-sm">Usuário</label>
<select id="userSelect" class="w-full border p-2 rounded">
<option value="">Carregando...</option>
</select>
</div>

<div>
<label class="text-sm">PIN</label>
<input id="pinInput" maxlength="4" class="w-full border p-2 rounded" placeholder="1234"/>
</div>

<div class="flex items-end">
<button id="loginBtn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
Entrar
</button>
</div>
</div>

<div id="loginError" class="hidden mt-3 text-red-600 text-sm"></div>
</section>

<!-- ================= FUNCIONARIO ================= -->
<section id="employeeSection" class="hidden max-w-5xl mx-auto space-y-4">

<div class="bg-white p-4 rounded-xl shadow flex justify-between">
<div>
<h2 class="font-semibold">Usuário: <span id="employeeName"></span></h2>
<p class="text-sm text-gray-500">Semana: <span id="weekLabel"></span></p>
</div>
<button id="logoutBtn1" class="bg-gray-200 px-3 py-2 rounded">Sair</button>
</div>

<div id="employeeTasks"></div>

</section>

<!-- ================= GERENTE ================= -->
<section id="managerSection" class="hidden max-w-6xl mx-auto space-y-4">

<div class="bg-white p-4 rounded-xl shadow flex justify-between">
<div>
<h2 class="font-semibold">Painel do Gerente</h2>
<p class="text-sm text-gray-500">Semana: <span id="managerWeekLabel"></span></p>
</div>
<button id="logoutBtn2" class="bg-gray-200 px-3 py-2 rounded">Sair</button>
</div>

<!-- Ranking -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-2">Ranking do mês</h3>
<div id="rankingList"></div>
</div>

<!-- Funcionários -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-2">Funcionários</h3>

<div class="flex gap-2 mb-3">
<input id="newEmployeeName" class="border p-2 rounded flex-1" placeholder="Nome do funcionário"/>
<button id="addEmployeeBtn" class="bg-blue-600 text-white px-3 rounded">Adicionar</button>
</div>

<div id="employeeList"></div>
</div>

<!-- Globais -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-3">Tarefas Globais (até 20 por semana)</h3>

<div class="flex gap-2 mb-3">
<input id="newGlobalName" class="border p-2 rounded flex-1" placeholder="Nome da GLOBAL"/>
<input id="newGlobalItems" class="border p-2 rounded flex-1" placeholder="Itens separados por vírgula"/>
<button id="createGlobalBtn" class="bg-blue-600 text-white px-3 rounded">Criar</button>
</div>

<div id="globalList"></div>
</div>

</section>

<!-- ================= TOAST ================= -->
<div id="toast" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 bg-black text-white px-4 py-2 rounded-xl text-sm"></div>

<script type="module">

// ================= FIREBASE =================
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getFirestore, doc, getDoc, setDoc, updateDoc,
collection, addDoc, onSnapshot,
query, orderBy, limit, deleteDoc, serverTimestamp, increment
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDsWJ9VVMSIsQNtifkLVnRNnbzU7favF7s",
authDomain: "missoes-drive.firebaseapp.com",
projectId: "missoes-drive",
storageBucket: "missoes-drive.firebasestorage.app",
messagingSenderId: "198254465545",
appId: "1:198254465545:web:dce028792e2c2c57161ed8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= STATE =================
let currentUser = null;
let currentStore = "principal";
let employees = [];
let globals = [];
let scores = {};

const managerName = {
principal: "GERENTE",
bogados: "BOGADOS - GERENTE"
};

// ================= UTIL =================
const $ = id => document.getElementById(id);

function toast(msg){
const t = $("toast");
t.textContent = msg;
t.classList.remove("hidden");
setTimeout(()=> t.classList.add("hidden"),2000);
}

function getWeekKey(){
const d = new Date();
const onejan = new Date(d.getFullYear(),0,1);
return d.getFullYear()+"-W"+Math.ceil((((d - onejan) / 86400000) + onejan.getDay()+1)/7);
}

const currentWeek = getWeekKey();
$("weekLabel").innerText = currentWeek;
$("managerWeekLabel").innerText = currentWeek;

<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Missões</title>

<meta name="theme-color" content="#2563eb"/>

<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-4">

<!-- ================= HEADER ================= -->
<header class="max-w-5xl mx-auto mb-4">
<div class="bg-white rounded-xl shadow p-4 flex justify-between items-center">
<div>
<h1 class="text-xl font-bold">Missões</h1>
<p id="headerSubtitle" class="text-sm text-gray-500">Login</p>
</div>
<div id="headerPoints" class="hidden text-right">
<div class="text-xs text-gray-500">Pontos do mês</div>
<div id="headerPointsValue" class="text-lg font-bold">0</div>
</div>
</div>
</header>

<!-- ================= LOGIN ================= -->
<section id="loginSection" class="max-w-4xl mx-auto bg-white p-4 rounded-xl shadow">
<h2 class="font-semibold mb-3">Entrar</h2>

<div class="grid md:grid-cols-4 gap-3">
<div>
<label class="text-sm">Loja</label>
<select id="storeSelect" class="w-full border p-2 rounded">
<option value="principal">Loja Principal</option>
<option value="bogados">Bogados</option>
</select>
</div>

<div>
<label class="text-sm">Usuário</label>
<select id="userSelect" class="w-full border p-2 rounded">
<option value="">Carregando...</option>
</select>
</div>

<div>
<label class="text-sm">PIN</label>
<input id="pinInput" maxlength="4" class="w-full border p-2 rounded" placeholder="1234"/>
</div>

<div class="flex items-end">
<button id="loginBtn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
Entrar
</button>
</div>
</div>

<div id="loginError" class="hidden mt-3 text-red-600 text-sm"></div>
</section>

<!-- ================= FUNCIONARIO ================= -->
<section id="employeeSection" class="hidden max-w-5xl mx-auto space-y-4">

<div class="bg-white p-4 rounded-xl shadow flex justify-between">
<div>
<h2 class="font-semibold">Usuário: <span id="employeeName"></span></h2>
<p class="text-sm text-gray-500">Semana: <span id="weekLabel"></span></p>
</div>
<button id="logoutBtn1" class="bg-gray-200 px-3 py-2 rounded">Sair</button>
</div>

<div id="employeeTasks"></div>

</section>

<!-- ================= GERENTE ================= -->
<section id="managerSection" class="hidden max-w-6xl mx-auto space-y-4">

<div class="bg-white p-4 rounded-xl shadow flex justify-between">
<div>
<h2 class="font-semibold">Painel do Gerente</h2>
<p class="text-sm text-gray-500">Semana: <span id="managerWeekLabel"></span></p>
</div>
<button id="logoutBtn2" class="bg-gray-200 px-3 py-2 rounded">Sair</button>
</div>

<!-- Ranking -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-2">Ranking do mês</h3>
<div id="rankingList"></div>
</div>

<!-- Funcionários -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-2">Funcionários</h3>

<div class="flex gap-2 mb-3">
<input id="newEmployeeName" class="border p-2 rounded flex-1" placeholder="Nome do funcionário"/>
<button id="addEmployeeBtn" class="bg-blue-600 text-white px-3 rounded">Adicionar</button>
</div>

<div id="employeeList"></div>
</div>

<!-- Globais -->
<div class="bg-white p-4 rounded-xl shadow">
<h3 class="font-semibold mb-3">Tarefas Globais (até 20 por semana)</h3>

<div class="flex gap-2 mb-3">
<input id="newGlobalName" class="border p-2 rounded flex-1" placeholder="Nome da GLOBAL"/>
<input id="newGlobalItems" class="border p-2 rounded flex-1" placeholder="Itens separados por vírgula"/>
<button id="createGlobalBtn" class="bg-blue-600 text-white px-3 rounded">Criar</button>
</div>

<div id="globalList"></div>
</div>

</section>

<!-- ================= TOAST ================= -->
<div id="toast" class="hidden fixed bottom-5 left-1/2 -translate-x-1/2 bg-black text-white px-4 py-2 rounded-xl text-sm"></div>

<script type="module">

// ================= FIREBASE =================
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
getFirestore, doc, getDoc, setDoc, updateDoc,
collection, addDoc, onSnapshot,
query, orderBy, limit, deleteDoc, serverTimestamp, increment
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDsWJ9VVMSIsQNtifkLVnRNnbzU7favF7s",
authDomain: "missoes-drive.firebaseapp.com",
projectId: "missoes-drive",
storageBucket: "missoes-drive.firebasestorage.app",
messagingSenderId: "198254465545",
appId: "1:198254465545:web:dce028792e2c2c57161ed8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================= STATE =================
let currentUser = null;
let currentStore = "principal";
let employees = [];
let globals = [];
let scores = {};

const managerName = {
principal: "GERENTE",
bogados: "BOGADOS - GERENTE"
};

// ================= UTIL =================
const $ = id => document.getElementById(id);

function toast(msg){
const t = $("toast");
t.textContent = msg;
t.classList.remove("hidden");
setTimeout(()=> t.classList.add("hidden"),2000);
}

function getWeekKey(){
const d = new Date();
const onejan = new Date(d.getFullYear(),0,1);
return d.getFullYear()+"-W"+Math.ceil((((d - onejan) / 86400000) + onejan.getDay()+1)/7);
}

const currentWeek = getWeekKey();
$("weekLabel").innerText = currentWeek;
$("managerWeekLabel").innerText = currentWeek;

